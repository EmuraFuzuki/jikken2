# ラズパイを用いた入力装置

## 機能
手の動きによる入力を取得する。両手を開けた状態や、手を触れずに操作を行いたい場合を想定した簡易的な入力装置である。

### 実装の詳細

#### 角速度入力
ジャイロセンサのx, y, z軸の角速度が一定以上になったときにそれぞれの入力信号を出力する。出力先はそれぞれ、黃、青、緑のLEDに接続する。

#### 距離入力
超音波センサを使用して入力を行う。センサとの距離が0~5cm, 5~10cm, 10~15cmの位置で1.0sec以上の間検出されたときにそれぞれ1個、2個、3個の赤色LEDを点灯させる。また、エアタップの動きを検出したときに、赤色LEDを点滅させる。

# 設計

## ファイル構成
- `main.py` - メイン実行ファイル
- `config.py` - 設定ファイル（GPIO ピン番号、定数）
- `utils/sensors.py` - センサー関連のクラス（MPU6050, HC-SR04, エアタップ検出）
- `utils/gpio_controller.py` - GPIO制御クラス


## pythonモジュール
- smbus
- time
- RPi.GPIO
- collections

## センサ
- MPU6050
- Ultrasonic Ranging Module (HC-SR04)


## 1. 回路設計（配線一覧）

| 役割                | Raspberry Pi GPIO | 物理ピン番号 (40 pin) | 接続先                      | メモ                                    |
| ----------------- | ----------------- | --------------- | ------------------------ | ------------------------------------- |
| **I2C SDA**       | GPIO 2            | 3               | MPU6050 SDA              | 3.3 V系                                |
| **I2C SCL**       | GPIO 3            | 5               | MPU6050 SCL              | 3.3 V系                                |
| **Gyro LED X（黄）** | GPIO 16           | 11              | 黄 LED アノード               | カソード→330 Ω→GND                        |
| **Gyro LED Y（青）** | GPIO 20           | 13              | 青 LED アノード               | 同上                                    |
| **Gyro LED Z（緑）** | GPIO 21           | 15              | 緑 LED アノード               | 同上                                    |
| **距離 LED 1（赤1）**  | GPIO 5            | 29              | 赤 LED 1 アノード             | 330 Ω→GND                             |
| **距離 LED 2（赤2）**  | GPIO 6            | 31              | 赤 LED 2 アノード             | 330 Ω→GND                             |
| **距離 LED 3（赤3）**  | GPIO 13           | 33              | 赤 LED 3 アノード             | 330 Ω→GND                             |
| **HC-SR04 TRIG**  | GPIO 23           | 16              | 超音波 TRIG                 | 3.3 V系                                |
| **HC-SR04 ECHO**  | GPIO 24           | 18              | 超音波 ECHO（電圧分圧後）          | 5 V→1 kΩ→ECHO→2 kΩ→GND（分圧で 3.3 V 以下に） |
| **3.3 V**         | —                 | 1               | MPU6050 VCC, HC-SR04 VCC | —                                     |
| **GND**           | —                 | 9 など            | 全 GND                    | 共通グラウンド                               |

## 2. 動作仕様とアルゴリズム

### 2.1 ジャイロ角速度入力

* MPU6050 の ±250 °/s フルスケールを使用（感度 131 LSB/(°/s)）。
* 各軸の絶対角速度が `GYRO_THRESHOLD [°/s]` を超えている間、その軸に対応する LED を点灯。

### 2.2 距離入力

1. **距離レンジ判定**

   * 連続測定で **1 秒以上** 同じレンジに留まった場合に確定。
   * 距離レンジと LED 数

     * 0 – 5 cm → 赤1 LED
     * 5 – 10 cm → 赤1+赤2
     * 10 – 15 cm → 赤1+赤2+赤3
   * 15 cm超またはレンジ未確定時は全赤 LED 消灯。
2. **エアタップ検出**

   * 直近 `TAP_WINDOW = 0.3 s` 内で 「距離が 10 cm超 → 5 cm未満 → 10 cm超」 の急変を検出。
   * 検出時、赤 LED 全点滅を `BLINK_TIMES` 回実行。
   * 距離レンジ LED 表示はブリンク終了後に再開。
