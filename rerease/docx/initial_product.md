以下に、要求仕様を満たす回路構成（配線図のテキスト説明）と Python 3 用ソースコード（実行ファイル 1 本）を示します。ハードウェアと GPIO 番号は一例ですので、環境に合わせて適宜変更してください。

---

## 1. 回路設計（配線一覧）

| 役割                | Raspberry Pi GPIO | 物理ピン番号 (40 pin) | 接続先                      | メモ                                    |
| ----------------- | ----------------- | --------------- | ------------------------ | ------------------------------------- |
| **I2C SDA**       | GPIO 2            | 3               | MPU6050 SDA              | 3.3 V系                                |
| **I2C SCL**       | GPIO 3            | 5               | MPU6050 SCL              | 3.3 V系                                |
| **Gyro LED X（黄）** | GPIO 17           | 11              | 黄 LED アノード               | カソード→330 Ω→GND                        |
| **Gyro LED Y（青）** | GPIO 27           | 13              | 青 LED アノード               | 同上                                    |
| **Gyro LED Z（緑）** | GPIO 22           | 15              | 緑 LED アノード               | 同上                                    |
| **距離 LED 1（赤1）**  | GPIO 5            | 29              | 赤 LED 1 アノード             | 330 Ω→GND                             |
| **距離 LED 2（赤2）**  | GPIO 6            | 31              | 赤 LED 2 アノード             | 330 Ω→GND                             |
| **距離 LED 3（赤3）**  | GPIO 13           | 33              | 赤 LED 3 アノード             | 330 Ω→GND                             |
| **HC-SR04 TRIG**  | GPIO 23           | 16              | 超音波 TRIG                 | 3.3 V系                                |
| **HC-SR04 ECHO**  | GPIO 24           | 18              | 超音波 ECHO（電圧分圧後）          | 5 V→1 kΩ→ECHO→2 kΩ→GND（分圧で 3.3 V 以下に） |
| **3.3 V**         | —                 | 1               | MPU6050 VCC, HC-SR04 VCC | —                                     |
| **GND**           | —                 | 9 など            | 全 GND                    | 共通グラウンド                               |

> **注意**
>
> * HC-SR04 の ECHO は 5 V 出力なので、必ず 1 kΩ/2 kΩ 等で 3.3 V 以下に分圧してください。
> * MPU6050 は 3.3 V 動作、I2C バスはラズパイ側のプルアップを利用。
> * LED には電流制限抵抗（220–330 Ω程度）を必ず挿入します。

---

## 2. 動作仕様とアルゴリズム

### 2.1 ジャイロ角速度入力

* MPU6050 の ±250 °/s フルスケールを使用（感度 131 LSB/(°/s)）。
* 各軸の絶対角速度が `GYRO_THRESHOLD [°/s]` を超えている間、その軸に対応する LED を点灯。

### 2.2 距離入力

1. **距離レンジ判定**

   * 連続測定で **1 秒以上** 同じレンジに留まった場合に確定。
   * 距離レンジと LED 数

     * 0 – 5 cm → 赤1 LED
     * 5 – 10 cm → 赤1+赤2
     * 10 – 15 cm → 赤1+赤2+赤3
   * 15 cm超またはレンジ未確定時は全赤 LED 消灯。
2. **エアタップ検出**

   * 直近 `TAP_WINDOW = 0.3 s` 内で 「距離が 10 cm超 → 5 cm未満 → 10 cm超」 の急変を検出。
   * 検出時、赤 LED 全点滅を `BLINK_TIMES` 回実行。
   * 距離レンジ LED 表示はブリンク終了後に再開。

---

## 3. Python ソースコード

[main.py](C:\Users\fengy\programming\jikken2\Device\docx\main.py)



### 主要パラメータの調整ポイント

| 定数                    | 役割                | 既定値          | 備考                     |
| --------------------- | ----------------- | ------------ | ---------------------- |
| `GYRO_THRESHOLD`      | 各軸 LED 点灯角速度しきい値  | 150 °/s      | 手の振り方に応じて 50–300 程度で調整 |
| `RangeTimer.hold_sec` | 距離レンジ確定に必要な連続検出時間 | 1.0 s        | 誤検出を下げたい場合は長めに         |
| `TAP_WINDOW`          | エアタップ判定に使う履歴時間幅   | 0.30 s       | 手早い前後動作に合わせる           |
| `TAP_NEAR / TAP_FAR`  | エアタップ近・遠距離閾値      | 5 cm / 10 cm | 手の長さやセンサー設置位置によって調整    |
| `BLINK_TIMES`         | エアタップ時の点滅回数       | 3            | 0 にすればブリンクなし           |

---

## 4. 使い方

1. 回路を表 1 に従って配線し、`gesture_input.py` をラズパイにコピー。
2. I2C を有効化 (`raspi-config` → Interface Options → I2C → Enable)。
3. 必要パッケージをインストール（未導入の場合）

   ```bash
   sudo apt-get install -y python3-smbus python3-rpi.gpio
   ```
4. 実行

   ```bash
   python3 gesture_input.py
   ```
5. `Ctrl+C` で終了。自動で LED を消灯し GPIO を解放します。

---

## 5. カスタマイズのヒント

* **角速度レンジ切替**
  MPU6050 の GYRO\_CONFIG レジスタ（0x1B）を書き換え、感度を ±500°/s（スケール 65.5）、±1000°/s（32.8）などに変更すると、激しい動作でも飽和しにくくなります。
* **複数動作の同時検知**
  現状は単純トリガ設計ですが、ジャイロと距離を組み合わせたジェスチャ（例：手のひねり＋前後動）を追加する場合は、状態機械やイベントキューを導入して拡張してください。
* **電源管理**
  MPU6050 の加速度計やスリープモードを併用するとアイドル時の消費電流を抑えられます。

---

以上で設計と実装例を示しました。部品の特性個体差や取り付け位置により、しきい値やタイミングは調整が必要です。不明点があればお知らせください。
