# ラズパイを用いた手ぶくろ入力装置

## 概要
手の動きによる入力を取得する装置です。両手を開けた状態や、手を触れずに操作を行いたい場合を想定した簡易的な入力装置です。

## 機能

### 角速度入力
- MPU6050ジャイロセンサを使用
- X, Y, Z軸の角速度が閾値以上になったときに、対応するLED（黄、青、緑）を点灯
- 最大角速度の軸のみ点灯する仕様

### 距離入力
- HC-SR04超音波センサを使用
- 3つの距離レンジで異なる数の赤色LEDを点灯
  - 0-5cm: 赤LED 1個
  - 5-10cm: 赤LED 2個  
  - 10-15cm: 赤LED 3個
- エアタップ動作検出時に赤色LEDを点滅表示

## システム構成

### ファイル構成
```
Device/
├── main.py                    # メイン実行ファイル
├── config.py                  # 設定ファイル（GPIO、定数）
├── test_main.py              # テストスクリプト
├── utils/
│   ├── sensors.py            # センサー制御クラス
│   └── gpio_controller.py    # GPIO制御クラス
└── README.md                 # このファイル
```

### 必要なPythonモジュール
- `smbus` - I2C通信用
- `RPi.GPIO` - GPIO制御用
- `time` - タイミング制御用
- `collections` - データ構造用

### 使用センサー
- **MPU6050** - 6軸ジャイロ・加速度センサ
- **HC-SR04** - 超音波距離センサ

## 回路設計

### GPIO配線表

| 役割                | Raspberry Pi GPIO | 物理ピン番号 | 接続先                      | メモ                                    |
| ----------------- | ----------------- | ---------- | ------------------------ | ------------------------------------- |
| **I2C SDA**       | GPIO 2            | 3          | MPU6050 SDA              | 3.3V系                                |
| **I2C SCL**       | GPIO 3            | 5          | MPU6050 SCL              | 3.3V系                                |
| **Gyro LED X（黄）** | GPIO 16           | 11         | 黄 LED アノード               | カソード→330Ω→GND                        |
| **Gyro LED Y（青）** | GPIO 20           | 13         | 青 LED アノード               | 同上                                    |
| **Gyro LED Z（緑）** | GPIO 21           | 15         | 緑 LED アノード               | 同上                                    |
| **距離 LED 1（赤1）**  | GPIO 5            | 29         | 赤 LED 1 アノード             | 330Ω→GND                             |
| **距離 LED 2（赤2）**  | GPIO 6            | 31         | 赤 LED 2 アノード             | 330Ω→GND                             |
| **距離 LED 3（赤3）**  | GPIO 13           | 33         | 赤 LED 3 アノード             | 330Ω→GND                             |
| **HC-SR04 TRIG**  | GPIO 23           | 16         | 超音波 TRIG                 | 3.3V系                                |
| **HC-SR04 ECHO**  | GPIO 24           | 18         | 超音波 ECHO（電圧分圧後）          | 5V→1kΩ→ECHO→2kΩ→GND（分圧で3.3V以下に） |
| **3.3V**         | —                 | 1          | MPU6050 VCC, HC-SR04 VCC | —                                     |
| **GND**           | —                 | 9等         | 全 GND                    | 共通グラウンド                               |

## 動作仕様

### ジャイロ角速度入力
- MPU6050の±250°/sフルスケールを使用（感度131 LSB/(°/s)）
- 各軸の絶対角速度が`GYRO_THRESHOLD [°/s]`を超えている間、その軸に対応するLEDを点灯
- 複数軸が閾値を超えた場合は、最大角速度の軸のみ点灯

### 距離入力

#### 距離レンジ判定
- 連続測定で**1秒以上**同じレンジに留まった場合に確定
- 距離レンジとLED数の対応：
  - 0-5cm → 赤LED 1個
  - 5-10cm → 赤LED 2個
  - 10-15cm → 赤LED 3個
- 15cm超またはレンジ未確定時は全赤LED消灯

#### エアタップ検出
- 手を近づける動作（速度基準）でエアタップを検出
- 検出範囲：0-25cm
- 最小近づき速度：15cm/s以上
- 検出時は赤LED全点滅を3回実行
- 距離レンジLED表示は点滅終了後に再開

## 使用方法

### 実行方法
```bash

sudo python main.py

```

### 設定変更
`config.py`で以下の設定を変更可能：
- GPIO ピン番号
- センサー感度・閾値
- LED点灯時間・点滅回数
- ループ周期

## 注意事項
- Raspberry Pi環境での実行が必要
- I2Cが有効になっている必要があります
- 適切な電圧分圧回路の設置が必要（HC-SR04のECHOピン用）
